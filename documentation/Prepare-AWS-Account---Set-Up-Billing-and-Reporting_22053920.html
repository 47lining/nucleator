<!DOCTYPE html>
<html>
  <head>
    <title>Nucleator: Prepare AWS Account - Set Up Billing and Reporting</title>
    <link rel="stylesheet" href="../css/site.css" type="text/css" />
    <link rel="stylesheet" href="../css/tips.css" type="text/css" />
    <link rel="stylesheet" href="../css/syntaxhighlighter.css" type="text/css" />
    <link rel="stylesheet" href="../css/sh-theme-rdark.css" type="text/css" />
    <script type="text/javascript" src="../css/syntaxhighlighter.js" ></script>
    <script type="text/javascript" src="../css/syntaxhighlighter-brushes.js" ></script>
    <script type="text/javascript">
      SyntaxHighlighter.all()
    </script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1.0, initial-scale=1" />
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <meta name="Author" content="47Lining LLC">
    <meta name="description" content="47Lining LLC: Nucleator DevOps Acceleration Tools">
    <meta name="keywords" content="Cloud, AWS, Amazon Web Services, Nucleator, Cloud, AWS, Amazon Web Services, Cloud Platform Operations, DevOps, Ansible">
    <link rel="stylesheet" type="text/css" href="../css/screen_styles.css" />
    <link rel="stylesheet" type="text/css" href="../css/screen_layout_large.css" />
    <link rel="stylesheet" type="text/css" media="only screen and (min-width:50px) and (max-width:1000px)" href="../css/screen_layout_small.css">
    <!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-58429312-2', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="page">
      <div class="secondaryHeader">
	<a class="secondaryLogo" href="../index.html"></a>
      </div>
      <article>
        <div id="breadcrumb-section">
          <ol id="breadcrumbs">
	    	    <li>
	      <span><a href="Nucleator-Documentation_22052969.html">Nucleator Documentation</a></span>
	    </li>
	    	    <li>
	      <span><a href="20545561.html">User&#39;s Guide</a></span>
	    </li>
	    	    <li>
	      <span><a href="How-to-Use-Nucleator_21463194.html">How to Use Nucleator</a></span>
	    </li>
	    	    <li>
	      <span><a href="Preparing-New-AWS-Accounts-for-use-with-Nucleator_21464098.html">Preparing New AWS Accounts for use with Nucleator</a></span>
	    </li>
	              </ol>
        </div>
        <h1>Prepare AWS Account - Set Up Billing and Reporting</h1>
        <div class="panel" style="border-width: 1px;"><div class="panelContent">
How to enable detailed billing, select Nucleator Tags for detailed billing, and link your new Account to your Master Account for Consolidated Billing
</div></div><p> </p><p>As your deployed footprint at AWS increases it becomes more important to understand and manage this infrastructure.  There are several powerful tools that help you to do this.  Nucleator supports these key AWS key infrastructure management tools:</p><ul><li><strong>Linked accounts:  </strong>AWS allows for multiple accounts to be linked together for payment an reporting purposes.  Assigning different parts of your business to use a unique AWS account provides great segregation for resources, costs and security decisions.  A common pattern is to have different business areas assigned to unique AWS accounts and to have these linked accounts aggregated with <strong>consolidated billing</strong>.</li><li><strong>User tags:  </strong>AWS allows for most resources to be given user defined tags that can hold business relevant information about the purpose, project, customer, or other information that will enable categorization of resource use and spend.</li><li><strong>Detailed billing reports: </strong>AWS will provide very detailed billing reports that include a wealth of data about your use of AWS resources and spend.</li><li><strong>Applying BI tools: </strong>Understanding the volume of data that results from a large AWS footprint can be quite challenging.  While the AWS cost explorer can provide insight into your organization's use of AWS resources it is often not powerful enough to extract the level of information that is needed to fully understand your AWS footprint.</li></ul><p>Many other tools exists in this space however, these four are generally underpinning most AWS infrastructure analysis processes and Nucleator works to support and enhance all these areas.</p><h2 id="PrepareAWSAccount-SetUpBillingandReporting-LinkedAccountsandConsolidatedBilling">Linked Accounts and Consolidated Billing</h2><p>The use of linked accounts is a business by business decision and is not required by Nucleator.  Nucleator does support operation across multiple AWS accounts (linked or otherwise) through use of the account parameter.  Nucleator can create Cages and Stacksets across a business' set of linked accounts.  This enables Nucleator to be a powerful deployment tool across multiple lines of business within your enterprise.</p><p>It is important for tracking purposes that consolidated billing is enabled so that AWS infrastructure reporting can consolidated and analyzed.  To sign up for consolidated billing</p><ol><li>Sign in to the AWS Management Console and open the Billing and Cost Management console at <a href="https://console.aws.amazon.com/billing/home#/" class="external-link" rel="nofollow">https://console.aws.amazon.com/billing/home#/</a>.</li><li>Click Consolidated Billing and follow the instructions on the page.</li></ol><p>Once the account owners have agreed to link the information for the accounts will be combined.  More information about consolidated billing can be found at <a href="http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html" style="line-height: 1.4285715;" class="external-link" rel="nofollow">http://docs.aws.amazon.com/awsaccountbilling/latest/aboutv2/consolidated-billing.html</a></p><h2 id="PrepareAWSAccount-SetUpBillingandReporting-UserTags">User Tags</h2><p>AWS allows for up to 10 user defined tags to be applied to most resources.  These user tags can be defined (by use convention) to be common between all resources for your AWS account or unique by resource.  The total number of user tags that can be defined can exceed 10 but only 10 can be applied to any one resource.</p><p>In order to maximize the utility of these user tags it is important to establish conventions within your organization.  By having a set of user tags that are common among all AWS infrastructure powerful business analyses can be performed that span all of your AWS accounts.  For example if infrastructure in support of a major client are all tagged the same then resource and cost analyses for this client can be easily viewed no matter if the resource is provisioned by marketing, R&amp;D or sales.  Also it is valuable to have some user tags be specific to the class or resource or department.   Nucleator uses such tool-specific tags as described here:  <a href="Nucleator-Resource-Tagging_22053508.html">Nucleator Resource Tagging</a>.  However, there is no AWS policy engine that will enforce your conventions so organizational processes will be needed to ensure that user tags are properly used.</p><p>47Lining recommendations for global user tags:</p><ul><li>Offering                       –             User Tag: Identifies the product, product line, development project, marketing campaign, or other other top level business purpose for the AWS infrastructure</li><li>Purpose                      –             User Tag: Identifies the (orthogonal to Offering) purposes for the infrastructure.  These include types such as environment (production, demo, dev, test), business process step (orders, front-end, fulfillment), class of materials (public materials, campaign operations, crm), etc. </li><li><span style="color: rgb(0,0,0);">Owner                        –              Identifier of the business-relevant principal (typically a user or role) that created / owns the asset</span><span style="color: rgb(0,0,0);"><br /></span></li><li><span style="color: rgb(0,0,0);">Name                         –              A unique name of the asset </span></li></ul><p><span style="color: rgb(0,0,0);">Applying these tags across all of your AWS resources in addition to using linked accounts to segregate the most macro of organizational divisions will allow for detailed analysis of your AWS resources and the charges that they drive.  For this to happen all of your AWS resources will need to adopt your tagging convention, including resources that are started manually.  When a common tagging methodology is applied to all your resources understanding the spent patterns and drivers will improve your AWS spend effectiveness.  To this end it is helpful to note that Nucleator can cause the creation of an untagged resource - AWS elsastic beanstalk will create an S3 bucket in every region it is run.  This bucket will be named elasticbeanstalk-{region}-{hash} and is a common resource for all elastic beanstalk operations within your account for that region.  Since this is a shared resource, Nucleator does not have the necessary information to appropriately apply tags to it.  Account owners should apply the 4 tags above to this bucket (done by modifying the bucket properties) manually.</span></p><p><span style="color: rgb(0,0,0);">Note: In order for user tags to flow to detailed AWS usage reports they will need to be marked for inclusion in these reports - see detailed billing reports section below.</span></p><h2 id="PrepareAWSAccount-SetUpBillingandReporting-DetailedBillingReports">Detailed Billing Reports</h2><p>Don't be fooled by the name – detailed billing reports provide a wealth of AWS usage information that is useful well outside of cost management.  These reports will include hour by hour usage information for all resources at AWS as well as the costs associated with this usage.  This information can provide a great deal of insight into your AWS resource usage, profile vs time, opportunities for cost-saving purchases such as reserved instances, spend by organization, tag or person etc.  </p><p>To enable detailed billing reports you will need to do the following for your master account:</p>    <div class="aui-message success shadowed information-macro">
                    <p class="title">Enable Detailed BIlling Reports</p>
                            <span class="aui-icon icon-success">Icon</span>
                <div class="message-content">
                            <ul class="inline-task-list" data-inline-tasks-content-id="22053920">
<li data-inline-task-id="1"><p>Log in to your AWS account console with billing change capability<br /><br /></p></li>
<li data-inline-task-id="2">Go to the S3 console and create a bucket where detailed billing information will be stored <br /><ol><li>Modify this bucket's policy to include the policy below<br /><br /></li></ol></li>
</ul>

<p> </p>    <div class="aui-message hint shadowed information-macro">
                            <span class="aui-icon icon-hint">Icon</span>
                <div class="message-content">
                            <p>In Accounts that have been prepared for use by Nucleator, the above step is performed automatically by <code>nucleator account setup</code></p><p><span class="breadcrumb-label">Nucleator creates a bucket with the following naming convention:</span></p><p><span class="breadcrumb-label"><code>billing-nucleator-&lt;account_name&gt;-&lt;customer_domain&gt;-&lt;uuidish&gt;</code></span></p><p><span class="breadcrumb-label">where:</span></p><p><code>&lt;account_name&gt;</code> is the account friendly name for the Acount</p><p><code>&lt;customer_domain&gt;</code> is the customer domain specified in customer's config file, with any &quot;.&quot; characters replaced by &quot;-&quot; characters.</p><p><code>&lt;uuidish&gt;</code> is a distinct character string generated by Nucleator that is intended to be unique. Because it is only six characters long, uniqueness is not guaranteed but is extremely probable.</p>
                    </div>
    </div>
<p style="margin-left: 30.0px;"> </p><ul class="inline-task-list" data-inline-tasks-content-id="22053920">
<li data-inline-task-id="3">Select the &quot;billing and cost management&quot; from the pull down next to your &quot;user @ account&quot; designation in the upper right of the console page </li>
<li data-inline-task-id="4">Select &quot;Preferences&quot; from the menu on the left</li>
<li data-inline-task-id="5">Select the checkbox next to &quot;Receive Billing Reports&quot;</li>
<li data-inline-task-id="6">Enter the bucket name where you would like billing reports to be located (See naming convention above if your billing bucket was created by Nucleator)</li>
<li data-inline-task-id="7">Click &quot;Verify&quot; to ensure that the policy for the bucket will allow billing reports to be written </li>
<li data-inline-task-id="8">Check all four check boxes for all types of billing reports</li>
<li data-inline-task-id="9">&quot;Save preferences&quot;</li>
<li data-inline-task-id="10">Click &quot;Manage Report Tags&quot;<ol><li>Ensure that all the global user tags are checked (above we recommended using the tags Offering, Purpose, Owner, and Name globally)</li><li>Ensure that all Nucleator tags are checked - NucleatorCage, NucleatorCustomer, NucleatorGroup, NucleatorStackset, NucleatorStacksetInstance</li><li>Check any other tags that will be of general ongoing interest to your organization (selecting all is not recommended as this list is a superset of all tags defined within your account at any time and the usefulness of many of these one-off tags is zero)</li></ol></li>
<li data-inline-task-id="11">&quot;Save&quot; Report Tags</li>
</ul>


                    </div>
    </div>
<p> </p><p>The AWS &quot;sample policy&quot; for a billing report bucket at the time of this writing is:</p><pre>{<br /> &quot;Version&quot;: &quot;2008-10-17&quot;,<br /> &quot;Id&quot;: &quot;Policy1335892530063&quot;,<br /> &quot;Statement&quot;: [<br /> {<br /> &quot;Sid&quot;: &quot;Stmt1335892150622&quot;,<br /> &quot;Effect&quot;: &quot;Allow&quot;,<br /> &quot;Principal&quot;: {<br /> &quot;AWS&quot;: &quot;<a href="http://arnawsiam:386209384616:root" class="external-link" rel="nofollow">arn:aws:iam::386209384616:root</a>&quot;<br /> },<br /> &quot;Action&quot;: [<br /> &quot;s3:GetBucketAcl&quot;,<br /> &quot;s3:GetBucketPolicy&quot;<br /> ],<br /> &quot;Resource&quot;: &quot;<a href="http://arnawss3billing-47lining-com" class="external-link" rel="nofollow">arn:aws:s3:::billing-47lining-com</a>&quot;<br /> },<br /> {<br /> &quot;Sid&quot;: &quot;Stmt1335892526596&quot;,<br /> &quot;Effect&quot;: &quot;Allow&quot;,<br /> &quot;Principal&quot;: {<br /> &quot;AWS&quot;: &quot;<a href="http://arnawsiam:386209384616:root" class="external-link" rel="nofollow">arn:aws:iam::386209384616:root</a>&quot;<br /> },<br /> &quot;Action&quot;: [<br /> &quot;s3:PutObject&quot;<br /> ],<br /> &quot;Resource&quot;: &quot;<a href="http://arnawss3billing-47lining-com" class="external-link" rel="nofollow">arn:aws:s3:::billing-47lining-com/*</a>&quot;<br /> }<br /> ]<br />}</pre><p><span style="color: rgb(0,0,0);"> </span></p><h2 id="PrepareAWSAccount-SetUpBillingandReporting-ApplyingBITools">Applying BI Tools</h2><p>Once you have enabled detailed billing reports your billing report bucket in your master account will receive a large volume of information updated multiple times per day.  The information is organized by month and single files will include information about resource use and cost for all linked accounts.  Gaining insight into your AWS footprint will not be achieved by simply viewing these files as the amount of data is too large.  At 47Lining we store our billing information in AWS' data warehouse offering Redshift and update the database twice daily.  By attaching BI tools to the Redshift database a wealth of information can be learned.  </p><p>47Lining Nucleator has a set of tools currently in the alpha stage of development that enable the importing of detailed billing information, transformation of this information, and standard analysis views into this data.  While this offering is not yet publicly available, 47Lining is looking for alpha users to provide feedback.  If interested please contact 47Lining by email at <a href="mailto:info@47lining.com" class="external-link" rel="nofollow">info@47lining.com</a> and indicate &quot;Billing Toolset alpha program&quot; in the subject.  The information below is based on our own internal use of this toolset.</p><p>There are a variety of BI tools that can be used to perform the analysis and presentation of your AWS usage information each with its own strengths and weaknesses.  This is a summary of the tools we have successfully used within 47lining for evaluating our data:</p><ul><li>Tableau<ul><li>Pro: Very powerful and intuitive to use</li><li>Con: Price</li></ul></li><li>Looker<ul><li>Pro: Active dashboard views that can be embedded in web pages</li><li>Con: Difficult to use in a data exploration mode and requires knowledge of Lookml programming language</li></ul></li><li>R<ul><li>Pro: Free and open source</li><li>Con: Software skills needed</li></ul></li></ul><p>With a BI toolset attached to Redshift there are several classes of report or metric that can be produced.  The dashboards we most often look at by class of report are:</p><ul><li>Spend patterns over time for<ul><li>Linked account</li><li>Offering and Purpose</li><li>AWS Product</li><li>Owner</li></ul></li><li>Resource usage<ul><li>ec2 hours per day per instance type</li><li>s3 usage by account, owner, and purpose</li><li>Data transfer charges by account, offering and purpose</li></ul></li><li>Nucleator activity over time and by account<ul><li>Cages</li><li>Stacksets</li></ul></li><li>Usage patterns by time of day<ul><li>DB usage</li><li>Data transfer charges</li><li>Elastic resources</li></ul></li><li>Non-compliant tagging<ul><li>Validation of use conventional tags</li><li>Validation of tags using agreed to values</li></ul></li></ul><p>This is just a partial lis of the information that can be seen in the AWS detailed billing reports and if additional sources of data, such as web server log archives and platform event log databases, are added there is no limit to business valuable information that can be learned.</p><p> </p><h3 id="PrepareAWSAccount-SetUpBillingandReporting-ExampleMetrics:">Example Metrics:</h3><p>Per-Product Cost by Hour and Linked Account (Tableau):</p><p><img class="confluence-embedded-image" src="attachments/22053920/22282371.png" data-image-src="attachments/22053920/22282371.png"></p><p> </p><p>Nucleator Cages by Hour and Linked Account (Looker):</p><p><img class="confluence-embedded-image" src="attachments/22053920/22282373.png" data-image-src="attachments/22053920/22282373.png"></p><p> </p><p>Running ec2 Instances by Hour of the Day (tableau):</p><p><img class="confluence-embedded-image" src="attachments/22053920/22282374.png" data-image-src="attachments/22053920/22282374.png"></p><p> </p><hr /><p>Next: <a href="https://confluence.47lining.com/display/NCD/Hardening+your+Nucleator+Installation+and+Launching+Nucleator%27s+User+Interface" rel="nofollow">Hardening your Nucleator Installation and Launching Nucleator's User Interface</a></p><p> </p><p> </p>
      </article>
      <div class="clear-fix"></div>
      <div class="secondaryNav">
	<a href="../installation.html">Installation</a>
	<a href="index.html">Documentation</a>
	<a href="../releases.html">Releases</a>
	<a href="../license.html">License</a>
	<a href="../community.html">Community</a>
      </div>
      <footer>
	&copy; Copyright 2016, <a href="http://www.47lining.com" target="_blank">47Lining, LLC</a>
      </footer>
    </div>   </body>
</html>
